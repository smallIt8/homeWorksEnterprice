name: Create PR for docs and README update

on:
  push:
    branches:
      - content-update

permissions:
  contents: write
  pull-requests: write

jobs:
  filter:
    runs-on: ubuntu-latest
    outputs:
      docs_changed: ${{ steps.filter.outputs.docs }}
    steps:
      - uses: actions/checkout@v3
      - uses: dorny/paths-filter@v3
        id: filter
        with:
          filters: |
            docs:
              - 'docs/**'
              - 'README.md'
              - '.github/**'

  create-pull-request:
    needs: filter
    runs-on: ubuntu-latest
    if: needs.filter.outputs.docs_changed == 'true'
    steps:
      - uses: actions/checkout@v3
        with:
          ref: content-update

      - name: Create or update Pull Request to main
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'Update docs and README.md'
          branch: content-update         # Здесь указываем ту же ветку, из которой пушите
          base: main                    # Целевая ветка для PR
          title: 'Auto-update docs and README.md'
          body: |
            Этот PR автоматически создаётся/обновляется для синхронизации изменений в папках docs, README.md и .github из content-update в main.
          labels: docs, auto-generated
          draft: false
